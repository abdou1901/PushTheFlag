generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement())
  github_id         String             @unique
  username          String
  github_username   String
  email             String?  
  pat               String?          
  leetcode_repo     String             @default("leetcode/")
  codeforces_repo   String             @default("codeforces/")
  ctf_repo          String             @default("ctf_writeups/")
  branch_name       String             @default("main")
  role              Role               @default(FREE)
  created_at        DateTime           @default(now())
  solved_leetcode   SolvedLeetcode[]
  solved_codeforces SolvedCodeforces[]
  ctf_writeups      CtfWriteup[]
}

model SolvedLeetcode {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  problem_id  String
  title       String
  difficulty  String
  language    String
  tags        String[]
  files       Json?
  created_at  DateTime @default(now())

  @@index([userId])
  @@index([created_at])
}

model SolvedCodeforces {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  contest_id  Int
  index       String 
  title       String
  difficulty  Int
  language    String?
  tags        String[]
  files       Json?
  created_at  DateTime @default(now())

  @@index([userId])
  @@index([created_at])
}

model CtfWriteup {
  id         Int         @id @default(autoincrement())
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     Int
  challenge  String
  category   CtfCategory
  is_public  Boolean     @default(false)
  created_at DateTime    @default(now())

  @@index([userId])
  @@index([created_at])
}

enum Role {
  FREE
  PREMIUM1
  PREMIUM2
  ADMIN
}

enum CtfCategory {
  WEB
  REV
  PWN
  CRYPTO
  MISC
  OSINT
  LINUX
}
