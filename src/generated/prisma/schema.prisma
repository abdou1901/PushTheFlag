generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement())
  github_id         String             @unique
  username          String
  email             String?            @unique
  role              Role               @default(FREE)
  created_at        DateTime           @default(now())
  solved_leetcode   SolvedLeetcode[]
  solved_codeforces SolvedCodeforces[]
  ctf_writeups      CtfWriteup[]
}

model SolvedLeetcode {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  problem_id  String
  title       String
  difficulty  String
  tags        String[]
  solution    String?
  ai_analysis String?
  created_at  DateTime @default(now())

  @@index([userId])
  @@index([created_at])
}

model SolvedCodeforces {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  problem_id  String
  title       String
  difficulty  Int
  tags        String[]
  solution    String?
  language    String?
  ai_analysis String?
  created_at  DateTime @default(now())

  @@index([userId])
  @@index([created_at])
}

model CtfWriteup {
  id         Int         @id @default(autoincrement())
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     Int
  challenge  String
  category   CtfCategory
  is_public  Boolean     @default(false)
  created_at DateTime    @default(now())

  @@index([userId])
  @@index([created_at])
}

enum Role {
  FREE
  PREMIUM
  ADMIN
}

enum CtfCategory {
  WEB
  REV
  PWN
  CRYPTO
  MISC
  OSINT
  LINUX
}
